<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euclid: Planetary Building Bricks</title>
    <style>
        :root {
            --dark-green: #062c1e;
            --light-green: #4ade80;
            --mid-green: #14532d;
            --white: #f0fdf4;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--dark-green);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--white);
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: relative;
            z-index: 10;
            pointer-events: none;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .stats {
            background: rgba(6, 44, 30, 0.8);
            border: 2px solid var(--light-green);
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.3);
            pointer-events: auto;
        }

        .score-val {
            color: var(--light-green);
            font-size: 1.5rem;
        }

        #message-area {
            text-align: center;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s;
            color: var(--light-green);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .footer {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .inventory {
            display: flex;
            gap: 10px;
            background: rgba(20, 83, 45, 0.5);
            padding: 10px;
            border-radius: 50px;
            border: 1px solid var(--light-green);
            pointer-events: auto;
        }

        .inv-slot {
            width: 40px;
            height: 40px;
            border: 2px dashed var(--light-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.3;
            transition: all 0.3s;
        }

        .inv-slot.filled {
            opacity: 1;
            border-style: solid;
            background: var(--light-green);
            box-shadow: 0 0 10px var(--light-green);
        }

        #start-screen {
            position: absolute;
            inset: 0;
            background: rgba(6, 44, 30, 0.95);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .logo-large {
            width: 120px;
            height: 120px;
            background: var(--light-green);
            clip-path: polygon(50% 0%, 61% 39%, 100% 50%, 61% 61%, 50% 100%, 39% 61%, 0% 50%, 39% 39%); /* Simplified star */
            /* Euclid star custom path using mask */
            -webkit-mask: radial-gradient(circle at 0 0, transparent 70%, black 71%),
                         radial-gradient(circle at 100% 0, transparent 70%, black 71%),
                         radial-gradient(circle at 0 100%, transparent 70%, black 71%),
                         radial-gradient(circle at 100% 100%, transparent 70%, black 71%);
            -webkit-mask-composite: destination-in;
            mask-composite: intersect;
            margin-bottom: 20px;
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); filter: drop-shadow(0 0 5px var(--light-green)); }
            to { transform: scale(1.1); filter: drop-shadow(0 0 20px var(--light-green)); }
        }

        button {
            background: var(--light-green);
            color: var(--dark-green);
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-3px);
            background: #fff;
        }

        .tutorial {
            font-size: 0.9rem;
            max-width: 300px;
            line-height: 1.4;
            color: #a5d6a7;
            margin-top: 20px;
        }

        #planet-progress {
            width: 200px;
            height: 6px;
            background: var(--mid-green);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        #progress-fill {
            width: 0%;
            height: 100%;
            background: var(--light-green);
            transition: width 0.3s;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen">
        <div class="logo-large"></div>
        <h1>EUCLID</h1>
        <p>Planetary Building Bricks</p>
        <div class="tutorial">
            The Euclid logo has shattered! <br>Collect 4 different <b>broken bricks</b> to assemble a complete planetary unit and earn points.
        </div>
        <button id="start-btn">CONSTRUCT</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="header">
            <div class="stats">
                SCORE: <span id="score" class="score-val">0</span>
            </div>
            <div class="stats">
                PLANETS: <span id="planets" class="score-val">0</span>
            </div>
        </div>

        <div id="message-area">BRICK ASSEMBLED!</div>

        <div class="footer">
            <div id="planet-progress"><div id="progress-fill"></div></div>
            <div class="inventory">
                <div class="inv-slot" id="slot-0"></div>
                <div class="inv-slot" id="slot-1"></div>
                <div class="inv-slot" id="slot-2"></div>
                <div class="inv-slot" id="slot-3"></div>
            </div>
            <div style="font-size: 0.7rem; letter-spacing: 1px; color: var(--light-green)">COLLECTION MATRIX</div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('start-btn');
    const startScreen = document.getElementById('start-screen');
    const scoreEl = document.getElementById('score');
    const planetsEl = document.getElementById('planets');
    const progressFill = document.getElementById('progress-fill');
    const messageArea = document.getElementById('message-area');

    let width, height;
    let score = 0;
    let planets = 0;
    let bricksInPlanet = 0;
    let gameActive = false;
    let fragments = [];
    let inventory = [false, false, false, false];
    let particles = [];

    const COLORS = {
        dark: '#062c1e',
        light: '#4ade80',
        mid: '#14532d'
    };

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    }

    window.addEventListener('resize', resize);
    resize();

    class Fragment {
        constructor() {
            this.type = Math.floor(Math.random() * 4); // 0: Top, 1: Right, 2: Bottom, 3: Left
            this.size = 40 + Math.random() * 30;
            this.reset();
        }

        reset() {
            this.x = Math.random() * width;
            this.y = height + 100;
            this.speed = 1.5 + Math.random() * 3;
            this.angle = Math.random() * Math.PI * 2;
            this.rotationSpeed = (Math.random() - 0.5) * 0.05;
            this.active = true;
        }

        update() {
            this.y -= this.speed;
            this.angle += this.rotationSpeed;
            if (this.y < -100) {
                this.reset();
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            ctx.fillStyle = COLORS.light;
            ctx.shadowBlur = 10;
            ctx.shadowColor = COLORS.light;
            
            // Draw one quadrant of the Euclid logo
            ctx.beginPath();
            ctx.moveTo(0, 0);
            
            // Logic to draw the specific quadrant
            const s = this.size;
            if (this.type === 0) { // Top
                ctx.quadraticCurveTo(s/4, -s/2, 0, -s);
                ctx.quadraticCurveTo(-s/4, -s/2, 0, 0);
            } else if (this.type === 1) { // Right
                ctx.quadraticCurveTo(s/2, s/4, s, 0);
                ctx.quadraticCurveTo(s/2, -s/4, 0, 0);
            } else if (this.type === 2) { // Bottom
                ctx.quadraticCurveTo(s/4, s/2, 0, s);
                ctx.quadraticCurveTo(-s/4, s/2, 0, 0);
            } else if (this.type === 3) { // Left
                ctx.quadraticCurveTo(-s/2, s/4, -s, 0);
                ctx.quadraticCurveTo(-s/2, -s/4, 0, 0);
            }
            
            ctx.fill();
            ctx.restore();
        }

        isClicked(mx, my) {
            const dx = mx - this.x;
            const dy = my - this.y;
            return Math.sqrt(dx*dx + dy*dy) < this.size;
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.vx = (Math.random() - 0.5) * 10;
            this.vy = (Math.random() - 0.5) * 10;
            this.life = 1.0;
            this.color = color;
            this.size = Math.random() * 4 + 2;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.life -= 0.02;
        }
        draw() {
            ctx.globalAlpha = this.life;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }
    }

    function spawnFragments(count) {
        for (let i = 0; i < count; i++) {
            fragments.push(new Fragment());
        }
    }

    function updateInventoryUI() {
        inventory.forEach((filled, i) => {
            const slot = document.getElementById(`slot-${i}`);
            if (filled) {
                slot.classList.add('filled');
                slot.innerHTML = 'ðŸ’Ž';
            } else {
                slot.classList.remove('filled');
                slot.innerHTML = '';
            }
        });
    }

    function checkAssembly() {
        if (inventory.every(item => item === true)) {
            // Assembly complete
            score += 100;
            bricksInPlanet += 20;
            
            if (bricksInPlanet >= 100) {
                planets++;
                bricksInPlanet = 0;
                showMessage("NEW PLANET CONSTRUCTED!");
            } else {
                showMessage("BRICK ASSEMBLED +100");
            }
            
            // Reset inventory
            inventory = [false, false, false, false];
            updateInventoryUI();
            
            // Visual feedback
            scoreEl.innerText = score;
            planetsEl.innerText = planets;
            progressFill.style.width = bricksInPlanet + '%';
            
            // Explode particles in center
            for(let i=0; i<30; i++) {
                particles.push(new Particle(width/2, height/2, COLORS.light));
            }
        }
    }

    function showMessage(txt) {
        messageArea.innerText = txt;
        messageArea.style.opacity = 1;
        setTimeout(() => {
            messageArea.style.opacity = 0;
        }, 2000);
    }

    canvas.addEventListener('mousedown', (e) => {
        if (!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;

        for (let i = fragments.length - 1; i >= 0; i--) {
            const f = fragments[i];
            if (f.isClicked(mx, my)) {
                // Collect fragment
                if (!inventory[f.type]) {
                    inventory[f.type] = true;
                    updateInventoryUI();
                    checkAssembly();
                    
                    // Particle effect at click
                    for(let j=0; j<10; j++) {
                        particles.push(new Particle(f.x, f.y, COLORS.light));
                    }
                    
                    f.reset();
                } else {
                    // Already have this piece, just bounce it or minor score
                    score += 5;
                    scoreEl.innerText = score;
                    f.reset();
                    for(let j=0; j<5; j++) {
                        particles.push(new Particle(mx, my, '#fff'));
                    }
                }
                break;
            }
        }
    });

    function drawEuclidLogo(x, y, size, color, glow = false) {
        ctx.save();
        ctx.translate(x, y);
        if (glow) {
            ctx.shadowBlur = 20;
            ctx.shadowColor = color;
        }
        ctx.fillStyle = color;
        
        ctx.beginPath();
        // Drawing the 4-pointed star shape based on Euclid logo
        // Top
        ctx.moveTo(0, -size);
        ctx.quadraticCurveTo(size * 0.2, -size * 0.2, size, 0);
        // Right
        ctx.quadraticCurveTo(size * 0.2, size * 0.2, 0, size);
        // Bottom
        ctx.quadraticCurveTo(-size * 0.2, size * 0.2, -size, 0);
        // Left
        ctx.quadraticCurveTo(-size * 0.2, -size * 0.2, 0, -size);
        
        ctx.fill();
        ctx.restore();
    }

    function loop() {
        ctx.fillStyle = COLORS.dark;
        ctx.fillRect(0, 0, width, height);

        // Draw background grid
        ctx.strokeStyle = COLORS.mid;
        ctx.lineWidth = 1;
        ctx.globalAlpha = 0.2;
        const spacing = 50;
        for(let x=0; x<width; x+=spacing) {
            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, height); ctx.stroke();
        }
        for(let y=0; y<height; y+=spacing) {
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(width, y); ctx.stroke();
        }
        ctx.globalAlpha = 1.0;

        if (gameActive) {
            fragments.forEach(f => {
                f.update();
                f.draw();
            });

            // Update and draw particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                p.draw();
                if (p.life <= 0) particles.splice(i, 1);
            }

            // Draw a faint ghost logo in the center if we are building
            ctx.globalAlpha = 0.1;
            drawEuclidLogo(width/2, height/2, 100, COLORS.light);
            ctx.globalAlpha = 1.0;
        }

        requestAnimationFrame(loop);
    }

    startBtn.addEventListener('click', () => {
        startScreen.style.display = 'none';
        gameActive = true;
        score = 0;
        planets = 0;
        bricksInPlanet = 0;
        fragments = [];
        spawnFragments(12);
        loop();
    });

    // Initial background loop for the start screen
    loop();

</script>
</body>
</html>
